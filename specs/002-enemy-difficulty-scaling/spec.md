# Feature Specification: 敵難易度の段階的スケーリング

**Feature Branch**: `002-enemy-difficulty-scaling`  
**Created**: 2025年10月19日  
**Status**: Draft  
**Input**: User description: "よりゲームの難易度を高くしてください。敵機が弾を発射するようにします。10秒間隔で、敵の動作、数を増やすようにしてください。最初は直線的な動きですが、徐々に曲線的で複雑な動きにするものとします。また、徐々に敵の耐性も上げてください"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 敵の弾発射機能 (Priority: P1)

プレイヤーは敵から発射される弾を避けながらゲームをプレイします。敵は定期的に弾を発射し、プレイヤーの自機に向かって攻撃します。

**Why this priority**: ゲームに戦略的な回避要素を追加し、基本的な挑戦性を提供する最も重要な機能です。これがなければ難易度向上が実現できません。

**Independent Test**: 敵の弾発射タイミング、弾の軌道、自機との当たり判定を単独でテストできます。これだけで既存ゲームに新しい挑戦要素を追加します。

**Acceptance Scenarios**:

1. **Given** ゲームプレイ中に敵が画面に存在する、**When** 敵の発射タイミングが到来する、**Then** 敵から弾が発射される
2. **Given** 敵の弾が発射された、**When** 弾が移動する、**Then** 弾はプレイヤーの自機方向に向かって直線的に進む
3. **Given** 敵の弾が画面上に存在する、**When** 弾が自機に接触する、**Then** ゲームオーバーになる
4. **Given** 敵の弾が画面上に存在する、**When** 弾が画面外に出る、**Then** 弾は消滅する

---

### User Story 2 - 時間経過による難易度段階的上昇 (Priority: P2)

プレイヤーはゲーム開始から10秒ごとに難易度が段階的に上昇するゲーム体験を得ます。敵の数が増加し、動きがより複雑になり、耐久力も向上します。

**Why this priority**: プレイヤーに継続的な挑戦と達成感を提供し、長期的なエンゲージメントを実現します。段階的な難易度上昇により、初心者から上級者まで楽しめます。

**Independent Test**: 10秒ごとの難易度レベル変更、敵の出現数増加、移動パターン変化、耐久力変化を個別にテストできます。

**Acceptance Scenarios**:

1. **Given** ゲーム開始から10秒経過した、**When** タイマーが10秒に到達する、**Then** 難易度レベルが1段階上昇する
2. **Given** 難易度レベルが上昇した、**When** 新しい敵が出現する、**Then** 以前より多い数の敵が出現する
3. **Given** 難易度レベルが上昇した、**When** 敵が移動する、**Then** より複雑な移動パターンで動く
4. **Given** 難易度レベルが上昇した、**When** 自機の弾が敵に当たる、**Then** 以前より多くのヒット数で敵が倒れる
5. **Given** ゲームプレイ中、**When** 画面を確認する、**Then** 現在の難易度レベルが表示される

---

### User Story 3 - 敵の複雑な移動パターン (Priority: P3)

プレイヤーは時間経過とともに、直線的な動きから曲線的で予測困難な動きをする敵と対峙します。

**Why this priority**: ゲームプレイの多様性と視覚的な面白さを向上させますが、基本的な挑戦性は他の要素で実現できます。

**Independent Test**: 各難易度レベルでの敵の移動パターン（直線、ジグザグ、円形、サイン波など）を個別にテストできます。

**Acceptance Scenarios**:

1. **Given** 難易度レベル1（0-10秒）、**When** 敵が出現する、**Then** 敵は直線的に移動する
2. **Given** 難易度レベル2（10-20秒）、**When** 敵が出現する、**Then** 敵はジグザグパターンで移動する
3. **Given** 難易度レベル3（20-30秒）、**When** 敵が出現する、**Then** 敵は曲線的（サイン波状）に移動する
4. **Given** 難易度レベル4以上（30秒以降）、**When** 敵が出現する、**Then** 敵は複数のパターンを組み合わせた複雑な軌道で移動する

---

### Edge Cases

- 難易度レベル上昇と同時に敵が倒された場合のスコア計算
- 難易度レベル上昇と同時にゲームオーバーになった場合の処理順序
- 複数の敵から同時に弾が発射された場合のパフォーマンス影響
- 画面上の敵や弾が多すぎる場合の上限処理（メモリやパフォーマンス保護）
- ゲーム一時停止中の難易度タイマー処理（停止するか継続するか）
- 非常に長時間プレイした場合の難易度上限設定

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは各敵に弾発射機能を持たせなければならない
- **FR-002**: システムは敵が定期的に弾を発射する仕組みを実装しなければならない
- **FR-003**: システムは敵の弾が自機方向に向かって移動するようにしなければならない
- **FR-004**: システムはゲーム開始から経過時間を10秒単位で追跡しなければならない
- **FR-005**: システムは10秒ごとに難易度レベルを1段階上昇させなければならない
- **FR-006**: システムは難易度レベルに応じて敵の出現数を増加させなければならない
- **FR-007**: システムは難易度レベルに応じて敵の移動パターンを変化させなければならない
- **FR-008**: システムは難易度レベル1では敵を直線的に移動させなければならない
- **FR-009**: システムは難易度レベル2以上では敵をジグザグまたは曲線的に移動させなければならない
- **FR-010**: システムは難易度レベル3以上では敵をサイン波や円形などの複雑なパターンで移動させなければならない
- **FR-011**: システムは難易度レベルに応じて敵の耐久力（必要ヒット数）を増加させなければならない
- **FR-012**: システムは現在の難易度レベルをゲーム画面に表示しなければならない
- **FR-013**: システムは難易度レベルごとに適切なバランス調整を行わなければならない
- **FR-014**: システムは画面上の敵と弾の数に上限を設定しなければならない（パフォーマンス保護）
- **FR-015**: システムは難易度レベル上昇時に視覚的または音声的なフィードバックを提供しなければならない

### Key Entities

- **難易度レベル**: ゲーム進行状況を表す段階（レベル番号、開始時刻、敵出現数、移動パターン定義、敵耐久力倍率）
- **敵の弾**: 敵から発射される攻撃オブジェクト（位置、移動方向、速度、発射元の敵）
- **移動パターン**: 敵の移動方式の定義（パターンタイプ、パラメータ、適用される難易度レベル）
- **敵の耐久力**: 敵を倒すために必要なヒット数（現在のヒット数、必要ヒット数、難易度レベルによる倍率）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: プレイヤーは敵の弾を視覚的に識別し、0.5秒以内に回避行動を取れる
- **SC-002**: システムは10秒ごとに正確に難易度レベルを上昇させる（誤差±0.1秒以内）
- **SC-003**: 難易度レベル5到達時には、レベル1の2倍以上の敵が画面に出現する
- **SC-004**: プレイヤーの80%以上が難易度レベルの上昇を認識できる（視覚的変化により）
- **SC-005**: ゲームは難易度レベル10到達時でも60FPS以上のパフォーマンスを維持する
- **SC-006**: 平均的なプレイヤーのゲーム継続時間が既存バージョンより30%以上向上する
- **SC-007**: 難易度レベル上昇による敵の移動パターン変化が滑らかで自然に見える

## Assumptions

- 敵の弾発射間隔は難易度レベルに応じて調整されます（初期値として2-3秒間隔を想定）
- 難易度レベルの上限は設定されますが、初期実装では10レベル程度を想定します
- 敵の耐久力は難易度レベル1では1ヒット、レベルごとに増加率を適用します
- 敵の出現数の上限は画面サイズとパフォーマンスから決定されます（初期想定：20-30体）
- 画面上の敵の弾の上限も設定されます（初期想定：50-100発）
- 移動パターンは段階的に複雑化しますが、プレイヤーが対応可能な範囲に留めます
- 難易度上昇は全プレイヤーに同じペースで適用されます（スキル適応型ではない）
- ゲーム一時停止中は難易度タイマーも停止します
- 既存のスコアシステムは難易度レベルを考慮したスコア倍率を適用します
- 敵の弾の速度は自機の弾より遅く設定し、回避可能性を確保します

